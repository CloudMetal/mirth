<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN' 'conf/dtd/mybatis-3-mapper.dtd'><mapper namespace='Statistic'>
   <resultMap id='get-statistics-result'
              type='com.mirth.connect.model.ChannelStatistics'>
      <result property='serverId' column='SERVER_ID'/>
      <result property='channelId' column='CHANNEL_ID'/>
      <result property='received' column='RECEIVED'/>
      <result property='filtered' column='FILTERED'/>
      <result property='sent' column='SENT'/>
      <result property='error' column='ERROR'/>
      <result property='queued' column='QUEUED'/>
      <result property='alerted' column='ALERTED'/>
   </resultMap>
   <insert id='createStatistics' parameterType='java.util.Map'>
		INSERT INTO
		CHANNEL_STATISTICS (SERVER_ID, CHANNEL_ID, RECEIVED, FILTERED, SENT, ERROR, QUEUED, ALERTED)
		VALUES ('${serverId}', '${channelId}', 0, 0, 0, 0, 0, 0)
	</insert>
   <update id='updateStatistics' parameterType='com.mirth.connect.model.ChannelStatistics'>
		UPDATE CHANNEL_STATISTICS
		SET RECEIVED = #{received}, FILTERED = #{filtered}, SENT = #{sent}, ERROR = #{error}, QUEUED = #{queued}, ALERTED = #{alerted}
		WHERE SERVER_ID = #{serverId} AND CHANNEL_ID = #{channelId} 
	</update>
   <select id='getStatistics'
           parameterType='java.util.Map'
           resultMap='get-statistics-result'>
		SELECT SERVER_ID, CHANNEL_ID, RECEIVED, FILTERED, SENT, ERROR, QUEUED, ALERTED
		FROM CHANNEL_STATISTICS
		WHERE SERVER_ID = '${serverId}' 
		<if test='channelId != null'>AND CHANNEL_ID = '${channelId}'</if>
	  </select>
</mapper>
