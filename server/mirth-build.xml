<project name="mirth" basedir="." default="create-setup">
	
	<target name="init">
		<property file="mirth-build.properties" />
	</target>

	<target name="create-extensions" depends="init">
		<ant antfile="${server}/build.xml" dir="${server}" target="create-plugins">
			<property name="version" value="${version}" />
		</ant>

		<copy todir="${client}/lib" flatten="true">
			<fileset dir="${server}/build/extensions/">
				<include name="**/*-shared.jar" />
			</fileset>
		</copy>

		<copy file="${server}/mirth-client-core.jar" todir="${client}/lib" />
		<copy file="${server}/lib/mirth-vocab-1.0.jar" todir="${client}/lib" />
		<copy file="${server}/mirth-client-core.jar" todir="${manager}/lib" />
	</target>

	<target name="create-client" depends="create-extensions">
		<ant antfile="${client}/ant-build.xml" dir="${client}" target="create-client" />

		<copy file="${client}/dist/mirth-client.jar" todir="${server}/client-lib/" />
		<copy file="${server}/mirth-client-core.jar" todir="${server}/client-lib/" />

		<copy todir="${server}/build/extensions/">
			<fileset dir="${client}/dist/extensions/" />
		</copy>

		<copy todir="${server}/client-lib">
			<fileset dir="${client}/lib">
				<exclude name="*-shared.jar" />
				<exclude name="extensions" />
			</fileset>
		</copy>
	</target>

	<target name="create-manager" depends="create-client">
		<ant antfile="${manager}/ant-build.xml" dir="${manager}" target="create-manager" />
	</target>

	<target name="create-setup" depends="create-manager">
		<ant antfile="${server}/build.xml" dir="${server}" target="create-setup">
			<property name="version" value="${version}" />
		</ant>
	</target>

	<target name="create-dist" depends="create-manager">
		<copy file="${manager}/dist/mirth-manager.jar" todir="${server}/" />

		<copy todir="${server}/manager-lib">
			<fileset dir="${manager}/lib">
				<exclude name="mirth-client.jar" />
			</fileset>
		</copy>

		<ant antfile="${server}/build.xml" dir="${server}" target="create-dist">
			<property name="version" value="${version}" />
		</ant>
	</target>
	
	<target name="append-license" depends="init">
		
		<path id="header.classpath">
			<fileset dir="${server}/lib">
				<include name="**/*.jar" />
			</fileset>
		</path>

		<taskdef name="header" classname="com.mirth.tools.header.HeaderTask">
			<classpath refid="header.classpath" />
		</taskdef>
		
		<header headerFile="${server}/license-header.txt" removeHeader="true" startOfHeader="/*" endOfHeader="*/" removeBlankLines="true">
			<fileset dir="${server}" includes="**/*.java" 
				excludes="src/org/**/*.java src/com/thoughtworks/**/*.java src/com/mirth/connect/connectors/**/*.java"/>
		</header>
		
		<header headerFile="${server}/license-header.txt" removeHeader="true" startOfHeader="/*" endOfHeader="*/" removeBlankLines="true">
			<fileset dir="${client}" includes="**/*.java" 
				excludes="src/com/mirth/connect/client/ui/BareBonesBrowserLaunch.java src/com/mirth/connect/client/ui/BeanBinder.java src/org/**/*.java"/>
		</header>
		
		<header headerFile="${server}/license-header.txt" removeHeader="true" startOfHeader="/*" endOfHeader="*/" removeBlankLines="true">
			<fileset dir="${manager}" includes="**/*.java" 
				excludes="src/com/mirth/connect/manager/BareBonesBrowserLaunch.java"/>
		</header>
		
	</target>

</project>
